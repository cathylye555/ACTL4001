library(readxl)
library(dplyr)

# Import data
mortality_table <- read_excel("Desktop/ACTL4001/combined_data.xlsx", sheet = "mortality_table")
superlife_data <- read_excel("Desktop/ACTL4001/combined_data.xlsx", sheet = "superlife_data")
economic_data <- read_excel("Desktop/ACTL4001/combined_data.xlsx", sheet = "economic_data")
intervention_data <- read_excel("Desktop/ACTL4001/combined_data.xlsx", sheet = "intervention")

#### EDA ####
# Plot of mortality graph
plot(mortality_table$`Age`,mortality_table$`Mortality Rate`, pch=19,cex=0.3,
     xlab="Mortality Rate", 
     ylab="Age",main="Mortality Rate vs Age")

# Check how many NA's in each variable
na_count <- t(superlife_data %>% summarise(across(everything(), ~ sum(is.na(.))))) # some NA's not showing!!!
superlife_data <- superlife_data %>% mutate(across(everything(), ~ replace((.), (.)=="NA", NA) )) # Replace character NA's with NA
na_count<-t(poo %>% summarise(across(everything(), ~ sum(is.na(.))))) # All NA's counted

# Investigate distribution of each variable
superlife_colnames <- colnames(superlife_data[,-1]) # investigating all columns but policy number

table_function<-function(colname){
 x<-which(superlife_colnames==colname)
 return(as.data.frame(table(superlife_data[x+1])))
} # returns a summary table

naming_function <- function(col){
  x<-table_function(colname=col)
  table_name <- paste0( "distribution_",col)
  assign(table_name,x,env = .GlobalEnv )
} # assigns table name to summary table

lapply(superlife_colnames,naming_function) # do for all variables

## Distribution findings
# 104023 lapsed policies, 6866 "Y" for lapse indicator ?
# 874139 alive & lapsed policies
# 40376 deaths 

# Check for any duplicated policy numbers
sum(duplicated(superlife_data$Policy.number)) # none 

# Cause of death key
cause_of_death <- c("Certain infectious and parasitic diseases", 
                    "Neoplasms", 
                    "Diseases of blood, blood-forming organs, disorders involving immune mechanism",
                    "Endocrine, nutritional and metabolic diseases",
                    "Mental and behavioural disorders",
                    "Diseases of the nervous system",
                    "Diseases of the circulatory system", 
                    "Diseases of the respiratory system",
                    "Diseases of the digestive system",
                    "Diseases of the skin and subcutaneous tissue",
                    "Diseases of the musculoskeletal system and connective tissue",
                    "Diseases of the genitourinary system",
                    "NA",
                    "Pregnancy, childbirth and the puerperium",
                    "Congenital malformations, deformations and chromosomal abnormalities",
                    "Symptoms, signs and abnormal clinical and laboratory findings, not elsewhere classified",
                    "External causes of morbidity and mortality"
                    ) 
  
cause_of_death_key <- cbind(as.vector(distribution_Cause.of.Death$Cause.of.Death),cause_of_death) # Key

distribution_Cause.of.Death <- cbind(distribution_Cause.of.Death,cause_of_death) # Key added onto distribution

